# Bifrost Server Configuration Example
# This file contains the configuration for the Bifrost proxy server.

server:
  http:
    listen: ":7080"           # Address to listen on for HTTP connections
    read_timeout: "30s"       # timeout for reading the entire request
    write_timeout: "30s"      # timeout for writing the response
    idle_timeout: "60s"       # timeout for keep-alive connections
  socks5:
    listen: ":7180"           # Address to listen on for SOCKS5 connections
  graceful_period: "30s"      # Time to wait for active connections to finish on shutdown

# Backend definitions
# Backends are upstream proxy servers or tunnels (WireGuard, Direct, etc.)
backends:
  # Direct connection (no tunnel)
  - name: direct
    type: direct
    enabled: true
    priority: 10

  # WireGuard tunnel example
  # - name: wg-tunnel
  #   type: wireguard
  #   enabled: true
  #   priority: 20
  #   config:
  #     private_key: "YOUR_PRIVATE_KEY_BASE64"
  #     address: "10.0.0.2/24"
  #     dns: ["1.1.1.1"]
  #     mtu: 1420
  #     peer:
  #       public_key: "PEER_PUBLIC_KEY_BASE64"
  #       endpoint: "vpn.example.com:51820"
  #       allowed_ips: ["0.0.0.0/0"]
  #       persistent_keepalive: 25

# Routing rules
# Determine which backend to use based on domain matching.
routes:
  # Default route - all traffic through the direct backend
  - domains: ["*"]
    backend: direct
    priority: 1

# Authentication settings
auth:
  mode: none                  # Auth mode (none, native, system, ldap, oauth)

# Rate limiting
# Control the flow of incoming requests.
rate_limit:
  enabled: false              # Enable rate limiting
  requests_per_second: 100    # Sustained rate limit
  burst_size: 200             # Maximum burst size
  per_ip: true                # Rate limit per IP address
  per_user: false             # Rate limit per authenticated user

# Access logging
# Log all connections handled by the server.
access_log:
  enabled: true               # Enable access logging
  format: json                # Log format (json, apache)
  output: stdout              # Output destination (stdout, stderr, or file path)

# Metrics
# Expose server metrics in Prometheus format.
metrics:
  enabled: true               # Enable metrics collection
  listen: ":7090"             # Address to listen on for metrics scraper
  path: "/metrics"            # URL path for metrics

# Application logging
# Configure server's own diagnostic logs.
logging:
  level: info                 # Log level (debug, info, warn, error)
  format: text                # Log format (json, text)
  output: stdout              # Output destination

# Web UI (Management interface)
web_ui:
  enabled: false              # Enable management dashboard
  listen: ":7081"             # Address to listen on for the Web UI

# REST API
# Programmatic management of the server.
api:
  enabled: true               # Enable REST API
  listen: ":7082"             # Address to listen on for the API
  # token: "your-api-token"   # Optional API authentication token
